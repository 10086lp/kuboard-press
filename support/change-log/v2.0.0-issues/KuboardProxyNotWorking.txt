020/06/11 14:04:59 [debug] 18#18: *26726 [lua] discover-service.out:0: discover(): annotationns --> prometheus.io/scrape:true
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] discover-service.out:0: discover(): annotationns --> proxy.kuboard.cn/disable-rebase-3000:true
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] discover-service.out:0: discover(): annotationns --> prometheus.io/tcp-probe-port:80
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] discover-service.out:0: discover(): annotationns --> prometheus.io/tcp-probe:true
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] discover-service.out:0: discover(): << proxyDiscovery:{"auth_header_groups":"X-WEBAUTH-GROUPS","name":"kuboard-loki-grafana","status":200,"disable_rebase":true,"ttl":36000,"target_ip":"10.96.252.210","namespace":"kube-system","auth_header_user":"X-WEBAUTH-USER","type":"Service"}
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] discover.out:0: discover(): << Encoded Content: s8rs0a33gufughkrgp93bmh3c8d6c2nm6dn9jme0dskf8lq3hsmhk4rgifigv6vbslrf8dk4ffmm50s9503akuvmonvuk0vgjsgpt31socjlnbhamchrgttdnsja0e57h8kbjc8nti14a216g652pqr7l93eigi7iupe1kf0smujnh523s1hceijdnbatlhmsmkl14m0u00c5o3rpkssf0mp8i2r58nuivsrvbc5pjk9o45qs86g5n7flh2vk3q90benf31k3vql0ea1h0hrtdot71uu3lv84kdopcd9k0u8g29ki5l30bem8ekp0demhul2tacdi05dv3jd57le53cv30l1g5lcuqqleu612g6s0j19u4v42hsn4v3ppd435lhnch96fe87a2ppaasoel4old89b7u2ieb9q9rchrmoil5hglrbr2btk2rnlf3coon8itahqfbdad859se0dtb0vdomoi3nb3h86gh8hfflppo0vt54d2kaqqh6i1q7q2fq5lmfk6jijasui083h1qcenv3pb3l63cnpesrush99toc42f0====
10.100.231.64 - - [11/Jun/2020:14:04:59 +0800] "GET /proxy/discover?type=Service&namespace=kube-system&name=kuboard-loki-grafana&port=3000&username-claim=preferred_username&groups-claim=groups HTTP/1.1" 200 922 "http://192.168.200.210:32567/namespace/default/workload/view/Deployment/details-v1" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36"
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] proxy.out:0: decodeCookie(): KuboardProxy -- namespace:kube-system, name:kuboard-loki-grafana, port:3000
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] proxy.out:0: decodeCookie(): ProxyDiscovery: {"auth_header_groups":"X-WEBAUTH-GROUPS","user_name":"zhaoyangyang","name":"kuboard-loki-grafana","status":200,"groups_name":["kfry","xmadmin"],"disable_rebase":true,"port":"3000","time":1591855499,"ttl":36000,"target_ip":"10.96.252.210","namespace":"kube-system","auth_header_user":"X-WEBAUTH-USER","type":"Service"}
2020/06/11 14:04:59 [debug] 18#18: *26726 [lua] proxy.out:0: decodeCookie(): set_auth_header(X-WEBAUTH-USER, zhaoyangyang)
2020/06/11 14:04:59 [error] 18#18: *26726 lua entry thread aborted: runtime error: ...ocal/openresty/nginx/kuboard-lua/kuboard/proxy/proxy.out:0: attempt to concatenate field 'groups_name' (a table value)
stack traceback:
coroutine 0:
        ...ocal/openresty/nginx/kuboard-lua/kuboard/proxy/proxy.out: in function 'decodeCookie'
        access_by_lua(nginx.80.conf:101):3: in main chunk, client: 10.100.231.64, server: , request: "GET /proxy/http/kube-system/kuboard-loki-grafana/:/3000/api/datasources HTTP/1.1", host: "192.168.200.210:32567", referrer: "http://192.168.200.210:32567/namespace/default/workload/view/Deployment/details-v1"
10.100.231.64 - - [11/Jun/2020:14:04:59 +0800] "GET /proxy/http/kube-system/kuboard-loki-grafana/:/3000/api/datasources HTTP/1.1" 500 413 "http://192.168.200.210:32567/namespace/default/workload/view/Deployment/details-v1" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36"
